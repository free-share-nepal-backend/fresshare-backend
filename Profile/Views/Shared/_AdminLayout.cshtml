<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Dashboard - Admin</title>

    <meta name="description" content="overview &amp; stats" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- basic styles -->
    <link rel="stylesheet" href="~/Content/datatables/css/datatables.bootstrap.css" />
    <link rel="stylesheet" href="~/Content/AdminCss/bootstrap.min.css" />
    <link rel="stylesheet" href="~/Content/AdminCss/font-awesome.min.css" />
    <link rel="stylesheet" href="~/Content/AdminCss/ace.min.css" />
    <link rel="stylesheet" href="~/Content/AdminCss/ace-fonts.css" />
    <link rel="stylesheet" href="~/Content/toastr.css">
    <link rel="stylesheet" href="~/Content/DataTables/css/jquery.dataTables.css">
    @*<link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.5.0/css/all.css' integrity='sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU' crossorigin='anonymous'>*@

    @*<style>
       img
        {
            margin-left:15px;
        }
        
    </style>*@
    <!--Scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="~/Scripts/AdminJs/bootstrap.min.js"></script>

</head>

<body>
    <div class="modal fade" id="changePasswordModal" role="dialog">
        <div class="modal-dialog" id="modalDialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Change Password</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="icon-lock"></i></span>
                            <input type="password" class="form-control" id="oldPassword" placeholder="Old Password" />
                        </div>
                        <div>
                            <span class="text-danger" id="oldPasswordError"></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="icon-key"></i></span>
                            <input type="password" class="form-control" id="newPassword" placeholder="New Password" />
                        </div>
                        <div>
                            <span class="text-danger" id="newPasswordError"></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="icon-key"></i></i></span>
                            <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm Password" />
                        </div>
                        <div>
                            <span class="text-danger" id="confirmPasswordError"></span>
                        </div>
                    </div>


                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-success" onclick="saveFunction();">Save Changes</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <div class="navbar navbar-default" id="navbar">
        <script type="text/javascript">
            try { ace.settings.check('navbar', 'fixed') } catch (e) { }
        </script>

        <div class="navbar-container" id="navbar-container">
            <div class="navbar-header pull-left">
                <a href="#" class="navbar-brand">
                    <small>
                        <i class="icon-leaf"></i>
                        Admin
                    </small>
                </a><!-- /.brand -->
            </div><!-- /.navbar-header -->

            <div class="navbar-header pull-right" role="navigation">
                <ul class="nav ace-nav">

                    <li class="light-blue">
                        <a data-toggle="dropdown" class="dropdown-toggle">
                            <!-- <img class="nav-user-photo" src="assets/avatars/user.jpg" alt="Jason's Photo" /> -->
                            <span class="user-info">
                                <small>Welcome,</small>
                                @Session["fullName"]
                            </span>

                            <i class="icon-caret-down"></i>
                        </a>

                        <ul class="user-menu pull-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
                            <li>
                                <a href="javascript:;" onclick="changePassword();">
                                    <i class="icon-cog"></i>
                                    Change Password
                                </a>
                            </li>

                            <li class="divider"></li>

                            <li>
                                <a href="@Url.Action("Logout","Admin")">
                                    <i class="icon-off"></i>
                                    Logout
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul><!-- /.ace-nav  left logout content-->
            </div><!-- /.navbar-header -->
        </div><!-- /.container -->
    </div>



    <div class="main-container" id="main-container">
        <script type="text/javascript">
            try { ace.settings.check('main-container', 'fixed') } catch (e) { }
        </script>

        <div class="main-container-inner">
            <a class="menu-toggler" id="menu-toggler" href="#">
                <span class="menu-text"></span>
            </a>

            <div class="sidebar" id="sidebar">
                <script type="text/javascript">
                    try { ace.settings.check('sidebar', 'fixed') } catch (e) { }
                </script>

                @*<div class="sidebar-shortcuts" id="sidebar-shortcuts">
                </div>*@<!-- #sidebar-shortcuts -->

                <ul class="nav nav-list">
                    <li class="active">
                        <a href="@Url.Action("Index","Admin")">
                            @*<i class="icon-picture"></i>*@
                            <img src="~/Images/Icon/dashboard.png" height="22" width="22"/>
                            <span class="menu-text"> Dashboard </span>
                        </a>
                    </li>

                    <li>
                        <a href="@Url.Action("ClientInfo","Admin")">
                            <img src="~/Images/Icon/Introduction.png" height="22" width="22" />
                            <span class="menu-text"> Introduction </span>
                        </a>
                    </li>

                    <li>
                        <a href="@Url.Action("AboutMe","Admin")">
                            <img src="~/Images/Icon/user.png" height="22" width="22" />
                            <span class="menu-text"> About Me </span>
                        </a>
                    </li>

                    <li>
                        <a href="@Url.Action("Education","Admin")">
                            <img src="~/Images/Icon/education.png" height="22" width="22" />
                            <span class="menu-text"> Education </span>
                        </a>
                    </li>

                    <li>
                        <a href="@Url.Action("Skill","Admin")">
                            <img src="~/Images/Icon/skill.png" height="22" width="22" />
                            <span class="menu-text"> Skill </span>
                        </a>
                    </li>

                    <li>
                        <a href="@Url.Action("Experience","Admin")">
                                <img src="~/Images/Icon/experience.png" height="22" width="22" />
                            <span class="menu-text"> Experience </span>
                        </a>
                    </li>

                    <li>
                        <a href="@Url.Action("Work","Admin")">
                            <img src="~/Images/Icon/work.png" height="22" width="22" />
                            <span class="menu-text"> Work </span>
                        </a>
                    </li>

                </ul><!-- /.nav-list -->

                <div class="sidebar-collapse" id="sidebar-collapse">
                    <i class="icon-double-angle-left" data-icon1="icon-double-angle-left" data-icon2="icon-double-angle-right"></i>
                </div>

                <script type="text/javascript">
                    try { ace.settings.check('sidebar', 'collapsed') } catch (e) { }
                </script>
            </div>

            <div class="main-content">
                <div class="breadcrumbs" id="breadcrumbs">
                    <script type="text/javascript">
                        try { ace.settings.check('breadcrumbs', 'fixed') } catch (e) { }
                    </script>

                    <ul class="breadcrumb">
                        <li>
                            <i class="icon-home home-icon"></i>
                            <a href="#">Home</a>
                        </li>
                        <li class="active">@ViewBag.breadcumb</li>
                    </ul><!-- .breadcrumb -->
                </div>
                <div class="page-content">
                    <div class="page-header">
                        <h1>
                            @ViewBag.breadcumb
                        </h1>
                    </div><!-- /.page-header -->
                    <div class="row">
                        <div class="col-xs-12">
                            @RenderBody()
                        </div>
                    </div>
                </div>
            </div><!-- /.main-container -->
            <!-- basic scripts -->
            <!--[if !IE]> -->

        </div>
    </div>


    <!--page content-->
    <!-- inline scripts related to this page -->
    <!--Bootbox and toastr scripts-->
    <script src="~/Scripts/AdminJs/ace.min.js"></script>
    <script src="~/Scripts/AdminJs/ace-elements.min.js"></script>
    <script src="~/Scripts/AdminJs/ace-extra.min.js"></script>

    <script src="~/Scripts/datatables/jquery.datatables.js"></script>
    <script src="~/Scripts/bootbox.js"></script>
    <script src="~/Scripts/toastr.js"></script>
    <script src="~/Scripts/datatables/datatables.bootstrap.js"></script>

    <script>
        //$(".nav-list").click(function(){
        //    alert("The paragraph was clicked.");
        //});

        function changePassword() {
            $('#changePasswordModal').modal("toggle");
        }

        function changePasswordValidator(oldPassword, newPassword, confirmPassword) {
            var checkOld = 0;
            var checkNew = 0;
            var checkConfirm = 0;

            if (oldPassword == "") {
                checkOld = 1;
            }

            if (!(checkOld == 1)) {
                if (oldPassword.length < 5) {
                    checkOld = 2;
                }
            }

            if (newPassword == "") {
                checkNew = 1;
            }

            if (!(checkNew == 1)) {
                if (newPassword.length < 5) {
                    checkNew = 2;
                }
            }

            if (checkOld == 1 && checkNew == 1) {
                $('#oldPasswordError').text("Required");
                $('#newPasswordError').text("Required");
                return false;
            }

            if (checkOld == 1 && checkNew == 2) {
                $('#oldPasswordError').text("Required");
                $('#newPasswordError').text("Must be at least 5 characters");
                return false;
            }

            if (checkOld == 2 && checkNew == 1) {
                $('#oldPasswordError').text("Must be at least 5 characters");
                $('#newPasswordError').text("Required");
                return false;
            }

            if (checkOld == 2 && checkNew == 2) {
                $('#oldPasswordError').text("Must be at least 5 characters");
                $('#newPasswordError').text("Must be at least 5 characters");
                return false;
            }

            if (checkNew == 0) {
                if (!(confirmPassword == newPassword)) {
                    checkConfirm = 1;
                }
                else if (checkOld == 1) {
                    $('#oldPasswordError').text("Required");
                    return false;
                }
                else if (checkOld == 2) {
                    $('#oldPasswordError').text("Must be at least 5 characters");
                    return false;
                }

                if (checkOld == 1 && checkConfirm == 1) {
                    $('#oldPasswordError').text("Required");
                    $('#confirmPasswordError').text("Pasword Mismatched");
                    return false;
                }

                if (checkOld == 2 && checkConfirm == 1) {
                    $('#oldPasswordError').text("Must be at least 5 characters");
                    $('#confirmPasswordError').text("Pasword Mismatched");
                    return false;
                }
            }

            if (checkNew == 1) {
                $('#newPasswordError').text("Required");
                return false;
            }
            if (checkNew == 2) {
                $('#newPasswordError').text("Must be at least 5 characters");
                return false;
            }

            if (oldPassword == newPassword) {
                $('#newPasswordError').text("Old password and New password cannot be same");
                return false;
            }

            if (!(confirmPassword == newPassword)) {
                $('#confirmPasswordError').text("Pasword Mismatched");
                return false;
            }

            return true;
        }

        function saveFunction() {
            onInputFunction();
            var oldPassword = $('#oldPassword').val();
            var newPassword = $('#newPassword').val();
            var confirmPassword = $('#confirmPassword').val();
            var userId = '@Session["userId"]';

            var result = changePasswordValidator(oldPassword, newPassword, confirmPassword);
            if (result == false) {
                return false;
            }

            $.ajax({
                type: 'post',
                url: '/Admin/ChangePassword',
                data: {
                    userId: userId, oldPassword: oldPassword, newPassword: newPassword
                },
                success: function (response) {
                    if (response == "success") {
                        $('#changePasswordModal').modal("toggle");
                        toastr.success("successfully changed");
                    }
                    else {
                        alert(response);
                    }

                },
                error: function (response) {

                }
            });
        }

        function onInputFunction() {
            $("#oldPassword").on('input', function () {
                $('#oldPasswordError').text("");
            });

            $("#newPassword").on('input', function () {
                $('#newPasswordError').text("");
            });

            $("#confirmPassword").on('input', function () {
                $('#confirmPasswordError').text("");
            });

        }

    </script>

    <!--session timeout-->
    <script>
        var timeout = @Session.Timeout;
        var sTimeout = parseInt(timeout) * 60 * 1000;
        var wintimeout;

        function SetWinTimeout() {
            wintimeout =  window.setTimeout( "window.location.href='/Admin/Logout';",sTimeout); // In millisecods
        }

        $('body').click(function() {
            window.clearTimeout(wintimeout);
            SetWinTimeout();
        });
        SetWinTimeout();
    </script>


</body>
</html>